# docker-compose.yml
version: '3.8'

services:
  # O serviço do servidor do jogo
  server:
    # A instrução 'build' diz ao Docker Compose como construir a imagem
    build:
      # O 'context' é a raiz do projeto, para que o Dockerfile possa encontrar o go.mod
      context: .
      # Especifica o caminho para o Dockerfile do servidor
      dockerfile: ./cmd/server/Dockerfile
    container_name: jokenpo-server
    # Mapeia as portas do container para a sua máquina local
    ports:
      - "8080:8080"
      - "8081:8081/udp"

  # O serviço do cliente interativo para um jogador humano
  client:
    build:
      context: .
      dockerfile: ./cmd/client/Dockerfile
    container_name: jokenpo-client
    # Garante que o cliente só tente conectar depois que o servidor estiver pronto
    depends_on:
      - server
    # --- LINHAS CRUCIAIS PARA CLIENTES INTERATIVOS ---
    # Mantém o STDIN aberto para que possamos digitar comandos no terminal
    stdin_open: true
    # Aloca um pseudo-TTY, o que torna a experiência do terminal correta
    tty: true