# docker-compose.yml
services:
  # O serviço do servidor do jogo
  server:
    build:
      context: .
      # Especifica o caminho para o Dockerfile do servidor
      dockerfile: ./cmd/server/Dockerfile
    container_name: jokenpo-server
    # Mapeia as portas do container para a sua máquina local
    ports:
      - "8080:8080"
      - "8081:8081/udp"

  # O serviço do cliente interativo para um jogador humano
  client:
    build:
      context: .
      dockerfile: ./cmd/client/Dockerfile
    container_name: jokenpo-client
    # Garante que o cliente só tente conectar depois que o servidor estiver pronto
    depends_on:
      - server
    
    # --- ADIÇÃO CRUCIAL AQUI ---
    # Define as variáveis de ambiente para o container do cliente.
    # O cliente usará 'server:8080' porque 'server' é o nome deste serviço na rede do Docker Compose.
    environment:
      - SERVER_ADDRESS=server:8080
      - PING_SERVER_ADDRESS=server:8081

    # --- LINHAS CRUCIAIS PARA CLIENTES INTERATIVOS ---
    # Mantém o STDIN aberto para que possamos digitar comandos no terminal
    stdin_open: true
    # Aloca um pseudo-TTY, o que torna a experiência do terminal correta
    tty: true